FROM node:22.14.0-alpine

USER node

RUN mkdir -p /home/node/code /home/node/db

WORKDIR /home/node/code

COPY --chown=node:node api/package-lock.json api/package.json ./

RUN npm ci

COPY --chown=node:node api/ .

# Copy the packages directory
COPY --chown=node:node db /home/node/db

CMD npm run dev